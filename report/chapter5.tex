\chapter{Network}

\section{Round trip time}
In this part, we try to calculate the round trip time.

\paragraph{Methodology}
The method is very simple, it's just like an echo server. Client send one byte to server, when server received the message then send back the message, and client receive it. Before client send message, we record current cycle; After client receive message, we record again. We iterate this procedure for 1000 times and get the average.

When iterating 1000 times and use the same opened connection. We did not use different connection, because it will add many TCP ACK overhead for connection. This experiment is only for RTT. The connection overhead will be measured in the following experiments.

\paragraph{Predictions}
Our predictions exclude the factor of building connection. So for loopback and remote interface, the biggest difference is send and receive data.

For loopback interface. We measure the hardware cycles are 20000, software cycles are 5000.

For remote interface. We measure the hardware cycles are 100000, software cycles are 10000.

\paragraph{Results}
We present our measured results.

\begin{center}
\begin{tabular}{| p{3cm} | p{3cm} | p{3cm} | p{3cm} | p{3cm} |}
Operation   & Base Hardware Performance  & Estimated Software Overhead  & Predicted Time  & Measured Time   \\
\hline
Loopback RTT & 20000 cycles& 5000 cycles& 25000 cycles& 69882 cycles\\
Remote RTT & 100000 cycles& 10000 cycles& 110000 cycles& 627772 cycles\\
\end{tabular}
\end{center}

Following is the Ping results.
\begin{center}
\begin{tabular}{l*{6}{c}r}
Operation       &  RTT & Corresponding Cycles\\
\hline
loopback & 0.070ms & 161000 cycles\\
remote & 0.196ms &  450800 cycles\\
\end{tabular}
\end{center}

\paragraph{Discussion}
The overhead of network communication is exceeding our predictions. Even the loopback interface is over 60000 cycles for only 1 byte transfer. \\


What can you deduce about baseline network performance and the overhead of OS software?  \\
In this experiment we only transfer 1 byte data. In the next experiment, we will go deep into the network performance and the overhead of OS software. Because bandwidth benchmark will reveal more about this.

How close to ideal hardware performance do you achieve? \\ 
It is far short of the ideal hardware performance because of the TCP/IP protocol.\\


What are reasons why the TCP performance does not match ideal hardware performance?  \\
It is expensive to establish TCP reliable connection, much time on handshake, including ACK packages and SYN packages.

\section{Peak bandwidth}
In this part, we try to explore peak bandwidth.

\paragraph{Methodology}
The code is very similar to the previous experiment.

In this experiment, when we establish the connection, the server will send some data to the client and the client will receive this chunk of data. The size of data is a parameter. We use several sizes like 1000000 bytes, the result is pretty similar.

Besides, we repeat our procedure more than 10 times and choose the maximum result as peak bandwidth.

\paragraph{Predictions}
According to the memory bandwidth provided by hardware information, we think the peak bandwidth of loopback interface is 1600MB/s. 

Because the network bandwidth is 1000Mb/s, which is about 125 MB/s. We predict the remote interface is 125MB/s.

\paragraph{Results}
We present our measured results.

\begin{center}
\begin{tabular}{l*{6}{c}r}
Operation       &  Predicted Speed& Measured Speed\\
\hline
Loopback Peak Bandwidth & 1600 MB/s & 1540 MB/s \\
Remote Peak Bandwidth & 125 MB/s  & 133 MB/s\\
\end{tabular}
\end{center}


\paragraph{Discussion}
Our predictions are very close to the measured results. For loopback interface, the speed is close to the memory bandwidth; For remote interface, the speed is close to the network bandwidth, we think it is because these two machines are in the same LAN.

We also think the bandwidth can be influenced by many factors. For example, if the two machine are far from each other, then the route path is undecidable and the bandwidth will be influenced. \\

How close to ideal hardware performance do you achieve? \\ 
It is close to the hardware performance due to the perfect experiment environment.

\section{Connection overhead}
In this part, we try to explore connection overhead.

\paragraph{Methodology}
We measure connection setup cycle at client side and connection tear-down cycle at server side.

\paragraph{Predictions}
First, we think it is more expensive to setup the connection than tear down. Because we use handshake protocal to setup the connection. 

Based on previous experience on RTT experiment, we made following predictions.

\paragraph{Results}
We present our measured results.

\begin{center}
\begin{tabular}{| p{3cm} | p{3cm} | p{3cm} | p{3cm} | p{3cm} |}
Operation  & Base Hardware Performance  & Estimated Software Overhead  & Predicted Time  & Measured Time   \\
\hline
Loopback Connection Setup & 35000 cycles& 5000 cycles& 40000 cycles& 306665 cycles \\
Loopback Connection Tear-down & 20000 cycles& 3000 cycles& 23000 cycles& 54334 cycles \\
Remote Connection Setup & 300000  cycles& 30000 cycles& 330000 cycles& 622923 cycles\\
Remote Connection Tear-down & 150000  cycles& 15000 cycles& 165000 cycles& 141333 cycles\\
\end{tabular}
\end{center}


\paragraph{Discussion}
Our predictions are neither far away from nor close to the measure results.